---
title: "Multiple Regression - Week 9, Lecture 2"
author: "Hector Gavilanes"
format: html
self-contained: true
editor: source
---

**A regional airline transfers passengers from small airports to a larger regional hub airport. The airlineâ€™s data analyst was assigned to estimate the revenue (in thousands of dollars) generated by each of the 22 small airports based on two variables: the distance from each airport (in miles) to the hub and the population (in hundreds) of the cities in which each of the 22 airports is located. The data are given here: [Google Sheet](https://docs.google.com/spreadsheets/d/10ZN0jMYdVsG2ucIJFSTquVRW916Jj-JmZIGQuqSQhy0/edit?usp=sharing).**

## Libraries
```{r setup, echo = TRUE, warnings = FALSE, message = FALSE}
library(tidyverse)
library(gsheet)
```

## Data
```{r}
# clear environment
rm(list = ls())

# extract data
data <- as_tibble(gsheet2tbl("https://docs.google.com/spreadsheets/d/10ZN0jMYdVsG2ucIJFSTquVRW916Jj-JmZIGQuqSQhy0/edit?usp=sharing"))
```


1. Summarize the data using appropriate summary statistics.
```{r}
summary(data)
```

2. Construct the correlation matrix for revenue, distance, and population. 
```{r}
# calculate Spearman's correlation matrix
cor(data,
    method = "spearman",
    use = "complete.obs")
```

3. Are any correlations in Q2 suspiciously high?

Yes, the correlation between Revenue and Population which is 0.762.

4. Model the revenue as a function of distance and population.

```{r}
airport_model <- lm(data$Revenue ~ data$Population + data$Distance)
summary(airport_model)
```
## Model formula:
$$\hat{y} = 144.39 + 1.09{\text{ population}} + 0.17{\text{ distance}} $$


5. Provide appropriate interpretations for the model coefficients.

### Interpretation
- When distance is 0 miles, and population is 0 persons, we expect the revenue to be at $144,390.
- As population increases by 1 person, the revenue increases by $1,094.20, after controlling for distance.
- As distance increases by 1 mile, the revenue increases by $170, after controlling for population.

6. Find the 95% confidence interval for all $\beta_i$.
```{r}
# confidence intervals
confint(airport_model)
```
- The 95% CI for $\beta_{population}$ is (0.67, 0.1.52).
- The 95% CI for $\beta_{distance}$ is (-0.15, 0.49).

7. Use the appropriate hypothesis test to determine if distance is a significant predictor of revenue. Test at the $\alpha=0.05$ level.

**Hypotheses**

- $H_0: \beta_{\text{distance}} = 0$
- $H_1: \beta_{\text{distance}} \ne 0$

**Test Statistic and *p*-value**

- $t_0 = 1.114$

- $p = 0.27916$

**Conclusion/Interpretation**

- Fail to reject $H_0$ at the $\alpha=0.05$ level. After adjusting for revenue, there is sufficient evidence to suggest that distance is not a significant predictor.

8. Use the appropriate hypothesis test to determine if population is a significant predictor of revenue. Test at the $\alpha=0.05$ level.

**Hypotheses**

- $H_0: \beta_{\text{population}} = 0$
- $H_1: \beta_{\text{population}} \ne 0$

**Test Statistic and *p*-value**

- $t_0 = 5.411$

- $p < 0.001$ 

**Conclusion/Interpretation**

- Reject $H_0$ at the $\alpha=0.05$ level. After adjusting for revenue, there is sufficient evidence to suggest that population is a significant predictor.


9. Use the appropriate hypothesis test to determine if this is a significant regression line. Test at the $\alpha=0.05$ level.

**Hypotheses**

- $H_0: \beta_{distance} = \beta_{population} = 0$
- $H_1:$ at least one $\beta_i$ is different.

**Test Statistic and *p*-value**

- $F_0 = 14.65$

- $p < 0.001$ 

**Conclusion/Interpretation**

- Reject $H_0$ at the $\alpha=0.05$ level. There is sufficient evidence to suggest that at least one variable is a significant predictor of revenue.

10. Find the $R^2_{\text{adj}}$ value and provide an interpretation.

- $R^2_{adj}$ is 0.5653 - 56.53% of the revenue is explained by the model with distance and population.

11. Construct a visualization for the model. At the very least, you should have a scatter plot with a regression line overlaid.

### Graph the Multiple Linear Model

#### Visualizing Distance
```{r}
# get coefficients
c1 <- coefficients(airport_model)
c1
# Distance on the X-axis
quantile(data$Population, na.rm = TRUE)
# create lines graph for Distance of 55, 74, 150
data <- data %>%
  mutate(d55 = c1[1] + c1[2]*55 + c1[3]*Distance,
         d74 = c1[1] + c1[2]*74 + c1[3]*Distance,
         d150 = c1[1] + c1[2]*150 + c1[3]*Distance)
# ggplot graph
data %>% ggplot(aes(x = Distance, y = Revenue)) +
  geom_point(size=3, color = "darkgray") + 
  geom_line(aes(y = d55), color = "orange") +
  geom_line(aes(y = d74), color = "magenta") +
  geom_line(aes(y = d150), color = "blue") +
  geom_text(aes(x = 352, y = 370, label = "150 miles")) +
  geom_text(aes(x = 352, y = 290, label = "74 miles")) +
  geom_text(aes(x = 352, y = 270, label = "55 miles")) +
  labs(title = "Multiple Linear Regression",
       x = "Distance",
       y = "Revenue") +
  xlim(c(120, 365))+
  theme_bw()
```
#### Visualizing Population
```{r}
# Population on the X-axis
quantile(data$Distance, na.rm = TRUE)
# create lines graph for Population of 150, 211, 300
data <- data %>%
  mutate(p150 = c1[1] + c1[2]*Population + c1[3]*150,
         p211 = c1[1] + c1[2]*Population + c1[3]*211,
         p300 = c1[1] + c1[2]*Population + c1[3]*300)
# ggplot graph
data %>% ggplot(aes(x = Population, y = Revenue)) +
  geom_point(size=3, color = "darkgray") + 
  geom_line(aes(y = p150), color = "orange") +
  geom_line(aes(y = p211), color = "magenta") +
  geom_line(aes(y = p300), color = "blue") +
  geom_text(aes(x =260, y = 460, label = "30,000 persons")) +
  geom_text(aes(x = 262, y = 445, label = "21,000 persons")) +
  geom_text(aes(x = 262, y = 430, label = "15,000 persons")) +
  labs(title = "Multiple Linear Regression",
       x = "Population",
       y = "Revenue") +
  xlim(c(50, 275))+
  theme_bw()
```