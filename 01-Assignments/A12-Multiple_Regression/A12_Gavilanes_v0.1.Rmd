---
title: "Multiple Regression - Week 9, Lecture 2"
author: "Hector Gavilanes"
format: html
self-contained: true
editor: source
---

**A regional airline transfers passengers from small airports to a larger regional hub airport. The airlineâ€™s data analyst was assigned to estimate the revenue (in thousands of dollars) generated by each of the 22 small airports based on two variables: the distance from each airport (in miles) to the hub and the population (in hundreds) of the cities in which each of the 22 airports is located. The data are given here: [Google Sheet](https://docs.google.com/spreadsheets/d/10ZN0jMYdVsG2ucIJFSTquVRW916Jj-JmZIGQuqSQhy0/edit?usp=sharing).**

## Libraries
```{r setup, echo = TRUE, warnings = FALSE, message = FALSE}
library(tidyverse)
library(gsheet)
```

## Data
```{r}
# clear environment
rm(list = ls())

# extract data
data <- as_tibble(gsheet2tbl("https://docs.google.com/spreadsheets/d/10ZN0jMYdVsG2ucIJFSTquVRW916Jj-JmZIGQuqSQhy0/edit?usp=sharing"))
```


1. Summarize the data using appropriate summary statistics.
```{r}
summary(data)
```

2. Construct the correlation matrix for revenue, distance, and population. 
```{r}
# calculate Pearson's correlation
cor(data,
    method = "pearson",
    use = "complete.obs")
```

3. Are any correlations in Q2 suspiciously high?

Yes, the correlation between Revenue and Population which is 0.762.

4. Model the revenue as a function of distance and population.

```{r}
airport_model <- lm(data$Revenue ~ data$Distance + data$Population)
summary(airport_model)
```
## Model formula:
$$\hat{y} = 144.39 + 0.17 distance + 1.09 population$$


5. Provide appropriate interpretations for the model coefficients.

### Interpretation
- When all airports, distance, and population are 0, we expect the revenue to be at $144,390.
- As distance increases by 1 mile, the revenue increases by $170, after controlling for population.
- As population increases by 1 person, the revenue increases by $1,094.20, after controlling for distance.

6. Find the 95% confidence interval for all $\beta_i$.
```{r}
# confidence intervals
confint(airport_model)
```
- The 95% CI for $\beta_{distance}$ is (-0.15, 0.49).
- The 95% CI for $\beta_{population}$ is (0.67, 0.1.52).

7. Use the appropriate hypothesis test to determine if distance is a significant predictor of revenue. Test at the $\alpha=0.05$ level.

**Hypotheses**

- $H_0: \beta_{\text{distance}} = 0$
- $H_1: \beta_{\text{distance}} \ne 0$

**Test Statistic and *p*-value**

- $t_0 = 1.114$

- $p = 0.27916$

**Conclusion/Interpretation**

- Fail to reject $H_0$ at the $\alpha=0.05$ level. After adjusting for revenue, there is sufficient evidence to suggest that distance is not a significant predictor.

8. Use the appropriate hypothesis test to determine if population is a significant predictor of revenue. Test at the $\alpha=0.05$ level.

**Hypotheses**

- $H_0: \beta_{\text{population}} = 0$
- $H_1: \beta_{\text{population}} \ne 0$

**Test Statistic and *p*-value**

- $t_0 = 5.411$

- $p < 0.001$ 

**Conclusion/Interpretation**

- Reject $H_0$ at the $\alpha=0.05$ level. After adjusting for revenue, there is sufficient evidence to suggest that population is a significant predictor.


9. Use the appropriate hypothesis test to determine if this is a significant regression line. Test at the $\alpha=0.05$ level.

**Hypotheses**

- $H_0: \beta_{distance} = \beta_{population} = 0$
- $H_1:$ at least one $\beta_i$ is different.

**Test Statistic and *p*-value**

- $F_0 = 14.65$

- $p < 0.001$ 

**Conclusion/Interpretation**

- Reject $H_0$ at the $\alpha=0.05$ level. There is sufficient evidence to suggest that at least one variable is a significant predictor of revenue.

10. Find the $R^2_{\text{adj}}$ value and provide an interpretation.

- $R^2_{adj}$ is 0.5653 - 56.53% of the revenue is explained by the model with distance and population.

11. Construct a visualization for the model. At the very least, you should have a scatter plot with a regression line overlaid.

```{r}
gg_regression <- ggplot(data,aes(x=Population,y=Revenue, color=factor(Distance)))+
                          geom_point(size=2)+
                          geom_smooth(formula= y~x, method=lm,se=FALSE,fullrange=TRUE)+
                          theme_bw()
gg_regression

# ggplt <- ggplot(data,aes(x=Population,y=Revenue,shape=Distance))+
#   geom_point()+
#   scale_shape_identity()+
#   theme_classic()
#   
# ggplt

```

```{r}
gg_population <- ggplot(data,aes(x=Population,y=Revenue))+
  scale_shape_identity()+
  geom_point(size=2, color = "darkgray")+
  geom_smooth(formula = y ~ x, method=lm,se=FALSE,fullrange=TRUE)+
  theme_classic()
gg_population

gg_distance <- ggplot(data,aes(x=Distance,y=Revenue))+
  scale_shape_identity()+
  geom_point(size=2, color = "darkgray")+
  geom_smooth(formula = y ~ x, method=lm,se=FALSE,fullrange=TRUE)+
  theme_classic()
gg_distance
```


